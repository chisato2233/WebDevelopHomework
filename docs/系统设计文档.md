# "好服务"平台系统设计文档

> **项目名称**：好服务原型系统
> **技术栈**：Django + Next.js + SQLite
> **文档版本**：v1.0
> **创建日期**：2024-11-24

---

## 目录

1. [项目概述与功能总结](#一项目概述与功能总结)
2. [技术架构设计](#二技术架构设计)
3. [数据库设计](#三数据库设计)
4. [后端API设计](#四后端api设计)
5. [前端页面设计](#五前端页面设计)
6. [技术实现方案](#六技术实现方案)
7. [开发计划与分工](#七开发计划与分工)
8. [部署与测试](#八部署与测试)

---

## 一、项目概述与功能总结

### 1.1 项目背景

"好服务"是一个社区服务供需匹配平台，旨在连接服务需求者和服务提供者，促进社区互助服务的高效对接。平台支持用户发布服务需求（"我需要"）和提供服务响应（"我服务"），实现双向选择和确认机制。

### 1.2 核心功能总结

#### **角色1：普通用户**

**身份A：服务需求发布者（"我需要"）**
- 📝 发布服务需求（支持文字、图片、视频上传）
- 🔍 查询自己发布的所有需求
- ✏️ 修改未被响应的需求
- 🗑️ 删除未被响应的需求
- 👀 查看所有响应并查看响应者信息
- ✅ 接受或拒绝服务响应

**身份B：服务提供者（"我服务"）**
- 🔍 浏览所有服务需求信息
- 📄 查看需求详细信息
- 💬 提交服务响应（支持文字、图片、视频）
- 📋 查询自己提交的所有响应
- ✏️ 修改未被接受的响应
- 🗑️ 删除未被接受的响应
- 🎯 查询已被接受的响应

**基础功能**
- 👤 用户注册（含密码强度验证）
- 🔐 用户登录
- ⚙️ 修改个人信息（手机号、简介、密码）

#### **角色2：管理员**

**必选功能**
- 📊 统计分析：按时间段、地域、服务类型统计
  - 月累计发布需求数
  - 月累计响应成功数
  - 图表可视化展示（默认显示近6个月）

**选做功能**
- 👥 查询所有用户信息
- 📑 条件查询"我需要"信息及发布者
- 📑 条件查询"我服务"信息及响应者

### 1.3 业务流程

```
用户A发布需求 → 用户B浏览需求 → 用户B提交响应 →
用户A查看响应 → 用户A接受/拒绝 → 记录响应成功明细 →
生成月度统计数据
```

### 1.4 服务类型

- 管道维修
- 助老服务
- 保洁服务
- 就诊服务
- 营养餐服务
- 定期接送服务
- （支持自定义其他类型）

---

## 二、技术架构设计

### 2.1 整体架构

```
┌───────────────────────────────────────────────────┐
│              前端层 - Next.js 14                   │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐        │
│  │ 页面路由 │  │ UI组件   │  │ 状态管理 │        │
│  └──────────┘  └──────────┘  └──────────┘        │
│  ┌────────────────────────────────────────┐      │
│  │      API请求层 (Axios/Fetch)            │      │
│  └────────────────────────────────────────┘      │
└───────────────────────────────────────────────────┘
                      ↕ REST API (JSON)
┌───────────────────────────────────────────────────┐
│           后端层 - Django 5.0 + DRF                │
│  ┌────────────────────────────────────────┐      │
│  │   API视图层 (ViewSets/APIView)          │      │
│  └────────────────────────────────────────┘      │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐        │
│  │ 序列化器 │  │ 业务逻辑 │  │ 权限验证 │        │
│  └──────────┘  └──────────┘  └──────────┘        │
│  ┌────────────────────────────────────────┐      │
│  │      ORM层 (Django ORM)                 │      │
│  └────────────────────────────────────────┘      │
└───────────────────────────────────────────────────┘
                      ↕ SQL
┌───────────────────────────────────────────────────┐
│           数据持久层 - SQLite3                      │
│  [用户表] [地域表] [需求表] [响应表] [统计表]      │
└───────────────────────────────────────────────────┘
```

### 2.2 技术栈详细说明

#### 2.2.1 前端技术栈

| 技术/库 | 版本 | 用途 |
|---------|------|------|
| Next.js | 14+ | React框架，SSR/SSG支持 |
| React | 18+ | UI构建 |
| TypeScript | 5+ | 类型安全 |
| Tailwind CSS | 3+ | 样式框架 |
| Ant Design / shadcn/ui | 最新 | UI组件库 |
| Axios | 最新 | HTTP请求 |
| React Hook Form | 最新 | 表单处理 |
| Zod | 最新 | 数据验证 |
| Chart.js / Recharts | 最新 | 数据可视化 |
| react-dropzone | 最新 | 文件上传 |

#### 2.2.2 后端技术栈

| 技术/库 | 版本 | 用途 | 框架要求 |
|---------|------|------|----------|
| Django | 5.0+ | Web框架 | 后台框架1 ✅ |
| Django REST Framework | 3.14+ | RESTful API | 后台框架2 ✅ |
| Django ORM | 内置 | 数据持久化 | 持久化框架 ✅ |
| SQLite | 3 | 数据库 | - |
| djangorestframework-simplejwt | 最新 | JWT认证 | - |
| django-cors-headers | 最新 | 跨域处理 | - |
| django-filter | 最新 | 查询过滤 | - |
| Pillow | 最新 | 图片处理 | - |

**满足课程要求**：
- ✅ 1种前端框架：Next.js
- ✅ 2种后台框架：Django + Django REST Framework
- ✅ 1种持久化框架：Django ORM

### 2.3 项目目录结构

```
WebDevelopHomework/
├── backend/                    # Django后端
│   ├── config/                # 项目配置
│   │   ├── settings.py       # 设置文件
│   │   ├── urls.py           # 根路由
│   │   └── wsgi.py
│   ├── apps/                  # 应用模块
│   │   ├── users/            # 用户模块
│   │   ├── regions/          # 地域模块
│   │   ├── needs/            # "我需要"模块
│   │   ├── responses/        # "我服务"模块
│   │   └── statistics/       # 统计分析模块
│   ├── media/                # 上传文件
│   ├── db.sqlite3            # SQLite数据库
│   ├── manage.py
│   └── requirements.txt      # Python依赖
│
├── frontend/                  # Next.js前端
│   ├── src/
│   │   ├── app/              # App Router页面
│   │   │   ├── (auth)/       # 认证相关页面
│   │   │   ├── needs/        # 需求相关页面
│   │   │   ├── responses/    # 响应相关页面
│   │   │   ├── statistics/   # 统计页面
│   │   │   └── profile/      # 个人信息
│   │   ├── components/       # 组件
│   │   ├── lib/              # 工具库
│   │   ├── types/            # TS类型定义
│   │   └── hooks/            # 自定义Hooks
│   ├── public/               # 静态资源
│   ├── package.json
│   └── next.config.js
│
├── docs/                      # 文档
│   ├── 需求原文.md
│   ├── 系统设计文档.md
│   └── 实现报告.md
│
└── sql.txt                    # 数据库导出文件
```

---

## 三、数据库设计

### 3.1 数据库ER图

```
        ┌─────────┐
        │  User   │
        │  用户表  │
        └────┬────┘
             │
      ┌──────┴──────┐
      │             │
      ↓1           1↓
┌──────────┐  ┌──────────┐
│   Need   │  │ Response │
│  需求表   │1 │  响应表   │
└────┬─────┘  └────┬─────┘
     │             │
     │n           n│
     └──────┬──────┘
            ↓
    ┌──────────────┐
    │AcceptedMatch │
    │ 响应成功明细  │
    └──────┬───────┘
           │
           ↓
    ┌──────────────┐
    │MonthlyStats  │
    │  月度统计表   │
    └──────────────┘

    ┌─────────┐
    │ Region  │  (关联到Need)
    │ 地域表   │
    └─────────┘
```

### 3.2 数据表设计

#### 3.2.1 用户表 (users)

| 字段名 | 类型 | 长度 | 约束 | 说明 |
|--------|------|------|------|------|
| id | INTEGER | - | PK, AUTO_INCREMENT | 用户标识 |
| username | VARCHAR | 50 | UNIQUE, NOT NULL | 用户名 |
| password | VARCHAR | 255 | NOT NULL | 加密密码 |
| user_type | VARCHAR | 20 | DEFAULT 'normal' | 用户类型：normal/admin |
| full_name | VARCHAR | 100 | NOT NULL | 用户姓名 |
| phone | VARCHAR | 11 | NOT NULL | 手机号码（11位） |
| bio | TEXT | - | NULL | 用户简介 |
| created_at | DATETIME | - | DEFAULT NOW | 注册时间 |
| updated_at | DATETIME | - | DEFAULT NOW | 修改时间 |

**初始数据**：
- 管理员账号：username='admin', password='admin'（需加密存储）

**密码验证规则**：
- 不少于6位
- 必须包含至少2个数字
- 不能全部为大写或全部为小写

**Django实现**：
```python
from django.contrib.auth.models import AbstractUser

class User(AbstractUser):
    USER_TYPE_CHOICES = [
        ('normal', '普通用户'),
        ('admin', '管理员'),
    ]
    user_type = models.CharField(max_length=20, choices=USER_TYPE_CHOICES, default='normal')
    full_name = models.CharField(max_length=100)
    phone = models.CharField(max_length=11)
    bio = models.TextField(blank=True)
```

#### 3.2.2 地域表 (regions)

| 字段名 | 类型 | 长度 | 约束 | 说明 |
|--------|------|------|------|------|
| id | INTEGER | - | PK, AUTO_INCREMENT | 地域标识 |
| name | VARCHAR | 100 | NOT NULL | 地域名称（区/县） |
| city | VARCHAR | 50 | NULL | 所属地市 |
| province | VARCHAR | 50 | NULL | 所属省份 |
| full_name | VARCHAR | 200 | NULL | 完整名称（省-市-区） |

**示例数据**：
```
id=1, name='西湖区', city='杭州市', province='浙江省', full_name='浙江省-杭州市-西湖区'
```

#### 3.2.3 需求表 (needs - "我需要")

| 字段名 | 类型 | 长度 | 约束 | 说明 |
|--------|------|------|------|------|
| id | INTEGER | - | PK, AUTO_INCREMENT | 需求标识 |
| user_id | INTEGER | - | FK, NOT NULL | 需求用户标识 |
| region_id | INTEGER | - | FK, NOT NULL | 地域标识 |
| service_type | VARCHAR | 50 | NOT NULL | 服务类型 |
| title | VARCHAR | 200 | NOT NULL | 需求主题名称 |
| description | TEXT | - | NOT NULL | 需求描述 |
| images | JSON | - | NULL | 图片文件路径数组 |
| videos | JSON | - | NULL | 视频文件路径数组 |
| status | INTEGER | - | DEFAULT 0 | 状态：0已发布/-1已取消 |
| created_at | DATETIME | - | DEFAULT NOW | 创建时间 |
| updated_at | DATETIME | - | DEFAULT NOW | 修改时间 |

**外键关系**：
- `user_id` → `users.id`
- `region_id` → `regions.id`

**业务规则**：
- 只有`status=0`且无响应的需求可以修改/删除
- 删除操作可改为软删除（设置status=-1）

#### 3.2.4 响应表 (responses - "我服务")

| 字段名 | 类型 | 长度 | 约束 | 说明 |
|--------|------|------|------|------|
| id | INTEGER | - | PK, AUTO_INCREMENT | 响应标识 |
| need_id | INTEGER | - | FK, NOT NULL | 需求标识 |
| user_id | INTEGER | - | FK, NOT NULL | 响应用户标识 |
| description | TEXT | - | NOT NULL | 响应描述 |
| images | JSON | - | NULL | 介绍图片路径数组 |
| videos | JSON | - | NULL | 介绍视频路径数组 |
| status | INTEGER | - | DEFAULT 0 | 状态：0待接受/1同意/2拒绝/3取消 |
| created_at | DATETIME | - | DEFAULT NOW | 创建时间 |
| updated_at | DATETIME | - | DEFAULT NOW | 修改时间 |

**外键关系**：
- `need_id` → `needs.id`
- `user_id` → `users.id`

**状态说明**：
- 0：待接受（可修改/删除）
- 1：已同意（不可修改）
- 2：已拒绝（不可修改）
- 3：已取消（用户主动取消）

#### 3.2.5 响应成功明细表 (accepted_matches)

| 字段名 | 类型 | 长度 | 约束 | 说明 |
|--------|------|------|------|------|
| id | INTEGER | - | PK, AUTO_INCREMENT | 主键 |
| need_id | INTEGER | - | FK, NOT NULL | 需求标识 |
| need_user_id | INTEGER | - | FK, NOT NULL | 发布需求用户标识 |
| response_id | INTEGER | - | FK, NOT NULL | 响应标识 |
| response_user_id | INTEGER | - | FK, NOT NULL | 响应用户标识 |
| accepted_date | DATE | - | NOT NULL | 接受日期 |
| service_type | VARCHAR | 50 | NULL | 服务类型（冗余） |
| region_id | INTEGER | - | FK, NULL | 地域标识（冗余） |
| created_at | DATETIME | - | DEFAULT NOW | 创建时间 |

**作用**：记录所有成功匹配的服务，用于生成月度统计

#### 3.2.6 月度统计表 (monthly_statistics)

| 字段名 | 类型 | 长度 | 约束 | 说明 |
|--------|------|------|------|------|
| id | INTEGER | - | PK, AUTO_INCREMENT | 主键 |
| month | VARCHAR | 6 | NOT NULL | 月份（YYYYMM） |
| region_id | INTEGER | - | FK, NULL | 地域标识 |
| region_name | VARCHAR | 200 | NULL | 地域名称（省-市） |
| service_type | VARCHAR | 50 | NOT NULL | 服务类型 |
| total_needs | INTEGER | - | DEFAULT 0 | 月累计发布需求数 |
| total_accepted | INTEGER | - | DEFAULT 0 | 月累计响应成功数 |
| created_at | DATETIME | - | DEFAULT NOW | 创建时间 |
| updated_at | DATETIME | - | DEFAULT NOW | 更新时间 |

**唯一约束**：`UNIQUE(month, region_id, service_type)`

**数据生成方式**：
- 方案1：定时任务（Celery）每月自动聚合
- 方案2：实时查询聚合（性能较低，适合数据量小的场景）

### 3.3 索引设计

```sql
-- 用户表
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_phone ON users(phone);

-- 需求表
CREATE INDEX idx_needs_user_id ON needs(user_id);
CREATE INDEX idx_needs_region_id ON needs(region_id);
CREATE INDEX idx_needs_service_type ON needs(service_type);
CREATE INDEX idx_needs_status ON needs(status);
CREATE INDEX idx_needs_created_at ON needs(created_at DESC);

-- 响应表
CREATE INDEX idx_responses_need_id ON responses(need_id);
CREATE INDEX idx_responses_user_id ON responses(user_id);
CREATE INDEX idx_responses_status ON responses(status);

-- 响应成功明细
CREATE INDEX idx_accepted_date ON accepted_matches(accepted_date);
CREATE INDEX idx_accepted_service_type ON accepted_matches(service_type);

-- 月度统计
CREATE INDEX idx_monthly_month ON monthly_statistics(month);
CREATE INDEX idx_monthly_region ON monthly_statistics(region_id);
```

---

## 四、后端API设计

### 4.1 API设计原则

- ✅ RESTful风格
- ✅ JSON数据格式
- ✅ Token认证（JWT）
- ✅ 统一响应格式
- ✅ 分页支持
- ✅ 过滤和排序

### 4.2 统一响应格式

**成功响应**：
```json
{
  "code": 200,
  "message": "success",
  "data": { ... }
}
```

**错误响应**：
```json
{
  "code": 400,
  "message": "错误描述",
  "errors": {
    "field_name": ["错误信息1", "错误信息2"]
  }
}
```

**分页响应**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "count": 100,
    "next": "http://api.example.com/needs/?page=2",
    "previous": null,
    "results": [ ... ]
  }
}
```

### 4.3 API端点列表

#### 4.3.1 认证模块 (auth)

| 方法 | 端点 | 功能 | 认证 |
|------|------|------|------|
| POST | `/api/auth/register/` | 用户注册 | ❌ |
| POST | `/api/auth/login/` | 用户登录 | ❌ |
| POST | `/api/auth/logout/` | 用户登出 | ✅ |
| GET | `/api/auth/profile/` | 获取当前用户信息 | ✅ |
| PUT | `/api/auth/profile/` | 修改用户信息 | ✅ |
| POST | `/api/auth/change-password/` | 修改密码 | ✅ |

**示例：用户注册**
```http
POST /api/auth/register/
Content-Type: application/json

{
  "username": "zhangsan",
  "password": "Pass12",
  "full_name": "张三",
  "phone": "13800138000",
  "bio": "热心市民"
}

Response 201:
{
  "code": 201,
  "message": "注册成功",
  "data": {
    "id": 1,
    "username": "zhangsan",
    "full_name": "张三",
    "token": "eyJ0eXAiOiJKV1QiLCJhbGc..."
  }
}
```

**示例：用户登录**
```http
POST /api/auth/login/
Content-Type: application/json

{
  "username": "zhangsan",
  "password": "Pass12"
}

Response 200:
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
    "user": {
      "id": 1,
      "username": "zhangsan",
      "full_name": "张三",
      "user_type": "normal"
    }
  }
}
```

#### 4.3.2 地域模块 (regions)

| 方法 | 端点 | 功能 | 认证 |
|------|------|------|------|
| GET | `/api/regions/` | 获取地域列表 | ✅ |
| GET | `/api/regions/{id}/` | 获取地域详情 | ✅ |

**查询参数**：
- `province`: 省份（可选）
- `city`: 城市（可选）

#### 4.3.3 需求模块 (needs)

| 方法 | 端点 | 功能 | 认证 |
|------|------|------|------|
| GET | `/api/needs/` | 获取需求列表（分页） | ✅ |
| POST | `/api/needs/` | 发布新需求 | ✅ |
| GET | `/api/needs/{id}/` | 获取需求详情 | ✅ |
| PUT | `/api/needs/{id}/` | 修改需求 | ✅ |
| PATCH | `/api/needs/{id}/` | 部分修改需求 | ✅ |
| DELETE | `/api/needs/{id}/` | 删除需求 | ✅ |
| GET | `/api/needs/my/` | 获取我的需求 | ✅ |
| GET | `/api/needs/{id}/responses/` | 获取需求的所有响应 | ✅ |

**示例：获取需求列表**
```http
GET /api/needs/?service_type=管道维修&region=1&page=1&page_size=10
Authorization: Bearer <token>

Response 200:
{
  "code": 200,
  "message": "success",
  "data": {
    "count": 25,
    "next": "/api/needs/?page=2",
    "previous": null,
    "results": [
      {
        "id": 1,
        "user": {
          "id": 2,
          "username": "zhangsan",
          "full_name": "张三"
        },
        "region": {
          "id": 1,
          "full_name": "浙江省-杭州市-西湖区"
        },
        "service_type": "管道维修",
        "title": "厨房水管漏水需要维修",
        "description": "厨房洗菜盆下方水管漏水...",
        "images": ["http://api.example.com/media/needs/1/image1.jpg"],
        "videos": [],
        "status": 0,
        "response_count": 3,
        "created_at": "2024-11-20T10:30:00Z"
      }
    ]
  }
}
```

**示例：发布需求**
```http
POST /api/needs/
Authorization: Bearer <token>
Content-Type: multipart/form-data

{
  "region_id": 1,
  "service_type": "管道维修",
  "title": "厨房水管漏水急需维修",
  "description": "厨房洗菜盆下方水管接头松动...",
  "images": [<File>, <File>],
  "videos": [<File>]
}

Response 201:
{
  "code": 201,
  "message": "需求发布成功",
  "data": {
    "id": 1,
    "title": "厨房水管漏水急需维修",
    ...
  }
}
```

**查询参数**：
- `service_type`: 服务类型（精确或模糊）
- `region`: 地域ID
- `status`: 状态
- `search`: 搜索关键词（标题/描述）
- `page`: 页码
- `page_size`: 每页数量

#### 4.3.4 响应模块 (responses)

| 方法 | 端点 | 功能 | 认证 |
|------|------|------|------|
| GET | `/api/responses/` | 获取响应列表 | ✅ |
| POST | `/api/responses/` | 提交响应 | ✅ |
| GET | `/api/responses/{id}/` | 获取响应详情 | ✅ |
| PUT | `/api/responses/{id}/` | 修改响应 | ✅ |
| DELETE | `/api/responses/{id}/` | 删除响应 | ✅ |
| GET | `/api/responses/my/` | 我的响应列表 | ✅ |
| GET | `/api/responses/my/accepted/` | 已接受的响应 | ✅ |
| POST | `/api/responses/{id}/accept/` | 接受响应 | ✅ |
| POST | `/api/responses/{id}/reject/` | 拒绝响应 | ✅ |

**示例：提交响应**
```http
POST /api/responses/
Authorization: Bearer <token>
Content-Type: multipart/form-data

{
  "need_id": 1,
  "description": "我有10年水电维修经验，可以上门服务...",
  "images": [<File>],
  "videos": []
}

Response 201:
{
  "code": 201,
  "message": "响应提交成功",
  "data": {
    "id": 1,
    "need_id": 1,
    "description": "...",
    "status": 0
  }
}
```

**示例：接受响应**
```http
POST /api/responses/1/accept/
Authorization: Bearer <token>

Response 200:
{
  "code": 200,
  "message": "响应已接受",
  "data": {
    "id": 1,
    "status": 1,
    "accepted_match_id": 1
  }
}
```

**业务逻辑**：
- 接受响应时：
  1. 验证当前用户是需求发布者
  2. 更新响应状态为1（已同意）
  3. 创建`accepted_matches`记录
  4. 更新或创建月度统计数据

#### 4.3.5 统计模块 (statistics)

| 方法 | 端点 | 功能 | 认证 |
|------|------|------|------|
| GET | `/api/statistics/monthly/` | 月度统计数据 | ✅ |
| GET | `/api/statistics/overview/` | 平台概览 | ✅ (Admin) |

**示例：月度统计**
```http
GET /api/statistics/monthly/?start_month=202401&end_month=202406&region_id=1
Authorization: Bearer <token>

Response 200:
{
  "code": 200,
  "message": "success",
  "data": {
    "statistics": [
      {
        "month": "202401",
        "region_name": "浙江省-杭州市",
        "service_type": "管道维修",
        "total_needs": 45,
        "total_accepted": 38
      },
      {
        "month": "202402",
        "region_name": "浙江省-杭州市",
        "service_type": "管道维修",
        "total_needs": 52,
        "total_accepted": 41
      }
    ],
    "chart_data": {
      "labels": ["2024-01", "2024-02", "2024-03", "2024-04", "2024-05", "2024-06"],
      "needs": [45, 52, 48, 56, 61, 59],
      "accepted": [38, 41, 42, 48, 53, 51]
    }
  }
}
```

**查询参数**：
- `start_month`: 起始年月（YYYYMM）
- `end_month`: 终止年月（YYYYMM）
- `region_id`: 地域ID（可选）
- `service_type`: 服务类型（可选）

#### 4.3.6 管理员模块 (admin) - 选做

| 方法 | 端点 | 功能 | 认证 |
|------|------|------|------|
| GET | `/api/admin/users/` | 查询所有用户 | ✅ (Admin) |
| GET | `/api/admin/needs/` | 条件查询需求 | ✅ (Admin) |
| GET | `/api/admin/responses/` | 条件查询响应 | ✅ (Admin) |

---

## 五、前端页面设计

### 5.1 页面路由结构

```
/                              # 首页（重定向到登录或仪表板）
├── /login                     # 登录页
├── /register                  # 注册页
├── /dashboard                 # 用户仪表板（需登录）
├── /profile                   # 个人信息页
│   └── /profile/edit         # 编辑个人信息
├── /needs                     # 浏览需求列表（"好服务"查询）
│   ├── /needs/[id]           # 需求详情页
│   └── /needs/[id]/respond   # 提交响应页
├── /my-needs                  # 我的需求（"我需要"）
│   ├── /my-needs/create      # 发布需求
│   ├── /my-needs/[id]/edit   # 编辑需求
│   └── /my-needs/[id]/responses  # 查看响应列表
├── /my-responses              # 我的响应（"我服务"）
│   ├── /my-responses/[id]/edit   # 编辑响应
│   └── /my-responses/accepted    # 已接受的响应
└── /statistics                # 统计分析（管理员）
```

### 5.2 页面详细设计

#### 5.2.1 用户注册页 (/register)

**功能**：
- 用户名、密码、确认密码、姓名、手机号、简介输入
- 实时密码验证提示
- 表单验证

**UI元素**：
```
┌─────────────────────────────────┐
│        好服务平台 - 用户注册      │
├─────────────────────────────────┤
│ 用户名：  [____________]         │
│ 密码：    [____________]         │
│          ⚠️ 密码提示              │
│ 确认密码：[____________]         │
│ 真实姓名：[____________]         │
│ 手机号：  [___________]          │
│ 个人简介：[____________]         │
│          (可选)                  │
│                                  │
│    [注册]  [已有账号？登录]      │
└─────────────────────────────────┘
```

**密码验证提示**：
- ✅ 至少6位
- ✅ 包含至少2个数字
- ✅ 包含大写和小写字母

**表单验证**：
- 用户名：必填，唯一
- 密码：符合规则
- 手机号：11位数字
- 其他：姓名必填

#### 5.2.2 用户登录页 (/login)

**功能**：
- 用户名、密码输入
- 登录验证
- 跳转到仪表板

**UI元素**：
```
┌─────────────────────────────────┐
│        好服务平台 - 登录          │
├─────────────────────────────────┤
│ 用户名：[____________]           │
│ 密码：  [____________]           │
│                                  │
│    [登录]  [没有账号？注册]      │
└─────────────────────────────────┘
```

#### 5.2.3 用户仪表板 (/dashboard)

**功能**：
- 显示用户基本信息
- 快速访问入口
- 最近动态展示

**UI布局**：
```
┌─────────────────────────────────────────────┐
│  Header [Logo] [导航] [用户菜单]            │
├──────┬──────────────────────────────────────┤
│      │  欢迎，张三                           │
│ Side │  ┌──────┐ ┌──────┐ ┌──────┐         │
│ bar  │  │我需要│ │我服务│ │浏览需求│        │
│      │  └──────┘ └──────┘ └──────┘         │
│ [我  │  ┌────────────────────────┐         │
│ 需要]│  │ 最近动态               │         │
│ [我  │  │ • 您的需求"水管维修"   │         │
│ 服务]│  │   收到3条新响应        │         │
│ [统计]│  │ • 您的响应被接受       │         │
│      │  └────────────────────────┘         │
└──────┴──────────────────────────────────────┘
```

#### 5.2.4 浏览需求页 (/needs)

**功能**：
- 显示所有需求列表
- 筛选：服务类型、地域
- 搜索：模糊查询
- 分页显示

**UI布局**：
```
┌─────────────────────────────────────────────┐
│  好服务需求列表                              │
├─────────────────────────────────────────────┤
│ 服务类型：[下拉选择▼]  地域：[选择▼]       │
│ 搜索：[_______________] [搜索]              │
├─────────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐    │
│ │ 【管道维修】厨房水管漏水急需维修     │    │
│ │ 地域：西湖区  |  发布者：张三         │    │
│ │ 描述：厨房洗菜盆下方...              │    │
│ │ 响应数：3  |  发布时间：2024-11-20   │    │
│ │                        [查看详情]    │    │
│ └─────────────────────────────────────┘    │
│ ┌─────────────────────────────────────┐    │
│ │ 【助老服务】需要陪同老人就诊         │    │
│ │ ...                                  │    │
│ └─────────────────────────────────────┘    │
│                                             │
│        [上一页]  1 / 10  [下一页]          │
└─────────────────────────────────────────────┘
```

#### 5.2.5 需求详情页 (/needs/[id])

**功能**：
- 显示完整需求信息
- 显示发布者信息
- 图片/视频展示
- 如果是自己的需求：显示响应列表
- 如果是别人的需求：显示"我服务"按钮

**UI布局（别人的需求）**：
```
┌─────────────────────────────────────────────┐
│  需求详情                                    │
├─────────────────────────────────────────────┤
│ 【管道维修】厨房水管漏水急需维修             │
│                                              │
│ 发布者：张三  |  联系电话：138****8000      │
│ 地域：浙江省-杭州市-西湖区                   │
│ 发布时间：2024-11-20 10:30                  │
│                                              │
│ 需求描述：                                   │
│ 厨房洗菜盆下方水管接头松动导致漏水严重...   │
│                                              │
│ 图片：                                       │
│ [图片1] [图片2] [图片3]                     │
│                                              │
│ 视频：                                       │
│ [视频播放器]                                 │
│                                              │
│           [我要提供服务]                     │
└─────────────────────────────────────────────┘
```

**UI布局（自己的需求）**：
```
┌─────────────────────────────────────────────┐
│  我的需求详情                                │
├─────────────────────────────────────────────┤
│ 【管道维修】厨房水管漏水急需维修             │
│ ...（同上）                                  │
│                                              │
│ [编辑需求] [删除需求]                        │
│                                              │
│ ─────── 收到的响应 (3条) ───────           │
│ ┌─────────────────────────────────────┐    │
│ │ 响应者：李四  |  联系电话：139****001 │    │
│ │ 简介：专业水电维修师傅，10年经验      │    │
│ │ 描述：我可以上门维修...              │    │
│ │ [查看详情] [接受] [拒绝]             │    │
│ └─────────────────────────────────────┘    │
│ ┌─────────────────────────────────────┐    │
│ │ 响应者：王五                          │    │
│ │ ...                                  │    │
│ └─────────────────────────────────────┘    │
└─────────────────────────────────────────────┘
```

#### 5.2.6 发布需求页 (/my-needs/create)

**功能**：
- 表单输入所有需求信息
- 文件上传（图片、视频）
- 提交确认

**UI元素**：
```
┌─────────────────────────────────────────────┐
│  发布服务需求                                │
├─────────────────────────────────────────────┤
│ 服务类型：[下拉选择▼] 或 [自定义_____]      │
│ 地域选择：[省▼] [市▼] [区▼]                │
│ 需求主题：[_________________________]       │
│ 需求描述：                                   │
│ [_______________________________________]   │
│ [_______________________________________]   │
│                                              │
│ 上传图片：                                   │
│ [拖拽或点击上传]                             │
│ [预览图1] [预览图2] ...                     │
│                                              │
│ 上传视频：                                   │
│ [拖拽或点击上传]                             │
│                                              │
│         [取消]  [发布需求]                   │
└─────────────────────────────────────────────┘
```

**提交确认对话框**：
```
┌───────────────────────────┐
│   确认发布需求？           │
├───────────────────────────┤
│   需求主题：xxx            │
│   服务类型：管道维修       │
│                            │
│    [取消]  [确认发布]      │
└───────────────────────────┘
```

#### 5.2.7 我的需求列表 (/my-needs)

**功能**：
- 显示自己发布的所有需求
- 状态标识
- 操作按钮

**UI布局**：
```
┌─────────────────────────────────────────────┐
│  我的需求                    [+ 发布新需求]  │
├─────────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐    │
│ │ 【管道维修】厨房水管漏水            │    │
│ │ 状态：已发布  |  响应数：3 🔔新     │    │
│ │ 发布时间：2024-11-20               │    │
│ │ [查看详情] [编辑] [删除]           │    │
│ └─────────────────────────────────────┘    │
│ ┌─────────────────────────────────────┐    │
│ │ 【助老服务】陪同老人就诊            │    │
│ │ 状态：已发布  |  响应数：0          │    │
│ │ [查看详情] [编辑] [删除]           │    │
│ └─────────────────────────────────────┘    │
└─────────────────────────────────────────────┘
```

#### 5.2.8 提交响应页 (/needs/[id]/respond)

**功能**：
- 显示原需求信息（只读）
- 填写响应信息
- 上传图片/视频

**UI布局**：
```
┌─────────────────────────────────────────────┐
│  提交服务响应                                │
├─────────────────────────────────────────────┤
│ 需求信息（只读）：                           │
│ ┌─────────────────────────────────────┐    │
│ │ 【管道维修】厨房水管漏水            │    │
│ │ 发布者：张三                        │    │
│ │ 描述：...                           │    │
│ └─────────────────────────────────────┘    │
│                                              │
│ 您的响应：                                   │
│ 服务描述：                                   │
│ [_______________________________________]   │
│ [_______________________________________]   │
│                                              │
│ 上传介绍图片：[拖拽或点击上传]              │
│ 上传介绍视频：[拖拽或点击上传]              │
│                                              │
│         [取消]  [提交响应]                   │
└─────────────────────────────────────────────┘
```

#### 5.2.9 我的响应列表 (/my-responses)

**功能**：
- 显示自己提交的所有响应
- 状态筛选
- 操作按钮

**UI布局**：
```
┌─────────────────────────────────────────────┐
│  我的服务响应                                │
├─────────────────────────────────────────────┤
│ 筛选：[全部▼] [待接受] [已同意] [已拒绝]   │
├─────────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐    │
│ │ 响应需求：【管道维修】厨房水管漏水  │    │
│ │ 状态：✅ 已同意                     │    │
│ │ 提交时间：2024-11-20               │    │
│ │ [查看详情]                         │    │
│ └─────────────────────────────────────┘    │
│ ┌─────────────────────────────────────┐    │
│ │ 响应需求：【助老服务】陪同就诊      │    │
│ │ 状态：⏳ 待接受                     │    │
│ │ [查看详情] [编辑] [删除]           │    │
│ └─────────────────────────────────────┘    │
└─────────────────────────────────────────────┘
```

#### 5.2.10 统计分析页 (/statistics)

**功能**：
- 查询条件输入
- 表格展示统计数据
- 图表可视化展示
- 默认显示近6个月

**UI布局**：
```
┌─────────────────────────────────────────────┐
│  服务统计分析                                │
├─────────────────────────────────────────────┤
│ 起始月份：[2024-06▼]  终止月份：[2024-11▼] │
│ 地域筛选：[全部▼]  服务类型：[全部▼]       │
│                          [查询] [导出]      │
├─────────────────────────────────────────────┤
│ 统计数据表格：                               │
│ ┌──────┬────────┬──────┬────┬────┐        │
│ │ 月份 │ 地域   │类型  │需求│成功│        │
│ ├──────┼────────┼──────┼────┼────┤        │
│ │202406│杭州-西湖│管道  │ 45 │ 38 │        │
│ │202407│杭州-西湖│管道  │ 52 │ 41 │        │
│ │...   │...     │...   │... │... │        │
│ └──────┴────────┴──────┴────┴────┘        │
│                                              │
│ 数据可视化：[折线图] [柱状图] [饼图]       │
│ ┌─────────────────────────────────────┐    │
│ │      60 ┤                      ●     │    │
│ │      50 ┤            ●    ●         │    │
│ │      40 ┤      ●                    │    │
│ │      30 ┤ ●                         │    │
│ │         └─────────────────────────  │    │
│ │          06  07  08  09  10  11     │    │
│ │   ● 发布需求数  ■ 响应成功数        │    │
│ └─────────────────────────────────────┘    │
└─────────────────────────────────────────────┘
```

#### 5.2.11 个人信息页 (/profile)

**功能**：
- 显示所有用户信息
- 编辑按钮

**UI布局**：
```
┌─────────────────────────────────────────────┐
│  个人信息                    [编辑信息]      │
├─────────────────────────────────────────────┤
│ 用户名：    zhangsan （不可修改）           │
│ 真实姓名：  张三 （不可修改）               │
│ 手机号码：  13800138000                     │
│ 用户类型：  普通用户                        │
│ 个人简介：  热心市民，乐于助人              │
│ 注册时间：  2024-11-01 10:30:00            │
│ 最近修改：  2024-11-20 15:20:00            │
└─────────────────────────────────────────────┘
```

#### 5.2.12 编辑信息页 (/profile/edit)

**功能**：
- 只能修改：手机号、简介、密码
- 其他字段灰显

**UI布局**：
```
┌─────────────────────────────────────────────┐
│  编辑个人信息                                │
├─────────────────────────────────────────────┤
│ 用户名：    zhangsan  （灰显，不可编辑）    │
│ 真实姓名：  张三      （灰显，不可编辑）    │
│ 手机号码：  [13800138000]                   │
│ 个人简介：  [_________________________]     │
│                                              │
│ 修改密码（可选）：                           │
│ 原密码：    [____________]                   │
│ 新密码：    [____________]                   │
│            ⚠️ 密码规则提示                   │
│ 确认密码：  [____________]                   │
│                                              │
│         [取消]  [保存修改]                   │
└─────────────────────────────────────────────┘
```

### 5.3 通用组件设计

#### 5.3.1 Header组件
- Logo
- 导航菜单：首页 | 浏览需求 | 我需要 | 我服务 | 统计（管理员）
- 用户菜单：个人信息 | 登出

#### 5.3.2 确认对话框
- 所有删除操作必须确认
- 所有接受/拒绝操作必须确认

#### 5.3.3 分页组件
- 显示总页数
- 上一页/下一页按钮
- 跳转到指定页

#### 5.3.4 文件上传组件
- 支持拖拽上传
- 图片预览
- 文件大小限制提示

#### 5.3.5 错误提示
- Toast提示（顶部/底部）
- 表单字段错误（红色，字段下方）

---

## 六、技术实现方案

### 6.1 后端实现关键点 (Django)

#### 6.1.1 项目初始化

```bash
# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 安装依赖
pip install django==5.0
pip install djangorestframework
pip install djangorestframework-simplejwt
pip install django-cors-headers
pip install django-filter
pip install pillow

# 创建项目和应用
django-admin startproject config .
python manage.py startapp users
python manage.py startapp regions
python manage.py startapp needs
python manage.py startapp responses
python manage.py startapp statistics
```

#### 6.1.2 Settings配置要点

```python
# config/settings.py

INSTALLED_APPS = [
    # Django默认
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',

    # 第三方
    'rest_framework',
    'rest_framework.authtoken',
    'corsheaders',
    'django_filters',

    # 自定义应用
    'apps.users',
    'apps.regions',
    'apps.needs',
    'apps.responses',
    'apps.statistics',
]

# DRF配置
REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework_simplejwt.authentication.JWTAuthentication',
    ],
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticated',
    ],
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 10,
}

# CORS配置
CORS_ALLOWED_ORIGINS = [
    "http://localhost:3000",
]

# 文件上传
MEDIA_URL = '/media/'
MEDIA_ROOT = BASE_DIR / 'media'

# 自定义用户模型
AUTH_USER_MODEL = 'users.User'
```

#### 6.1.3 用户模型实现

```python
# apps/users/models.py
from django.contrib.auth.models import AbstractUser
from django.db import models

class User(AbstractUser):
    USER_TYPE_CHOICES = [
        ('normal', '普通用户'),
        ('admin', '管理员'),
    ]

    user_type = models.CharField(max_length=20, choices=USER_TYPE_CHOICES, default='normal')
    full_name = models.CharField(max_length=100)
    phone = models.CharField(max_length=11)
    bio = models.TextField(blank=True)

    class Meta:
        db_table = 'users'
```

#### 6.1.4 密码验证实现

```python
# apps/users/validators.py
from django.core.exceptions import ValidationError

def validate_password(password):
    if len(password) < 6:
        raise ValidationError('密码不少于6位')

    digit_count = sum(c.isdigit() for c in password)
    if digit_count < 2:
        raise ValidationError('密码必须包含至少2个数字')

    if password.isupper() or password.islower():
        raise ValidationError('密码不能全部为大写或小写')

    return password
```

#### 6.1.5 文件上传处理

```python
# apps/needs/models.py
class Need(models.Model):
    images = models.JSONField(default=list, blank=True)
    videos = models.JSONField(default=list, blank=True)

    def save_uploaded_files(self, images=None, videos=None):
        if images:
            self.images = [self._save_file(f, 'images') for f in images]
        if videos:
            self.videos = [self._save_file(f, 'videos') for f in videos]

    def _save_file(self, file, file_type):
        from django.core.files.storage import default_storage
        path = f'needs/{self.id}/{file_type}/{file.name}'
        return default_storage.save(path, file)
```

#### 6.1.6 统计聚合查询

```python
# apps/statistics/views.py
from django.db.models import Count
from django.db.models.functions import TruncMonth

class MonthlyStatisticsView(APIView):
    def get(self, request):
        queryset = AcceptedMatch.objects.all()

        # 按月聚合
        stats = queryset.annotate(
            month=TruncMonth('accepted_date')
        ).values('month', 'service_type', 'region__full_name').annotate(
            total_accepted=Count('id')
        )

        return Response({'statistics': list(stats)})
```

### 6.2 前端实现关键点 (Next.js)

#### 6.2.1 项目初始化

```bash
# 创建项目
npx create-next-app@latest frontend --typescript --tailwind --app

# 安装依赖
cd frontend
npm install axios
npm install react-hook-form zod @hookform/resolvers
npm install chart.js react-chartjs-2
npm install antd  # 或 npm install @radix-ui/react-*
```

#### 6.2.2 API客户端封装

```typescript
// src/lib/api.ts
import axios from 'axios';

const api = axios.create({
  baseURL: 'http://localhost:8000/api',
});

// 请求拦截器
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

export default api;
```

#### 6.2.3 认证Hook

```typescript
// src/hooks/useAuth.ts
import { useState, useEffect } from 'react';

export function useAuth() {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  const login = async (username, password) => {
    const res = await api.post('/auth/login/', { username, password });
    localStorage.setItem('token', res.data.data.token);
    setUser(res.data.data.user);
  };

  const logout = () => {
    localStorage.removeItem('token');
    setUser(null);
  };

  return { user, loading, login, logout };
}
```

#### 6.2.4 表单验证

```typescript
// src/lib/validation.ts
import { z } from 'zod';

export const passwordSchema = z.string()
  .min(6, '密码不少于6位')
  .refine((pwd) => (pwd.match(/\d/g) || []).length >= 2, '至少2个数字')
  .refine((pwd) => /[A-Z]/.test(pwd) && /[a-z]/.test(pwd), '需大小写混合');
```

#### 6.2.5 图表组件

```typescript
// src/components/statistics/Chart.tsx
import { Line } from 'react-chartjs-2';

export function MonthlyChart({ data }) {
  const chartData = {
    labels: data.labels,
    datasets: [
      {
        label: '发布需求数',
        data: data.needs,
        borderColor: 'rgb(75, 192, 192)',
      },
      {
        label: '响应成功数',
        data: data.accepted,
        borderColor: 'rgb(255, 99, 132)',
      },
    ],
  };

  return <Line data={chartData} />;
}
```

### 6.3 数据库初始化

```sql
-- 创建管理员（Django命令）
python manage.py createsuperuser

-- 或直接SQL插入（密码需Django加密）
INSERT INTO users (username, password, user_type, full_name, phone, bio)
VALUES ('admin', 'pbkdf2_sha256$...', 'admin', '管理员', '13800000000', '');

-- 插入地域数据
INSERT INTO regions (name, city, province, full_name) VALUES
('西湖区', '杭州市', '浙江省', '浙江省-杭州市-西湖区'),
('余杭区', '杭州市', '浙江省', '浙江省-杭州市-余杭区');

-- 插入测试需求
INSERT INTO needs (user_id, region_id, service_type, title, description, status)
VALUES (2, 1, '管道维修', '厨房水管漏水', '急需维修...', 0);
```

---

## 七、开发计划与分工

### 7.1 开发阶段

#### 阶段1：环境搭建与基础功能（第1-2周）
- [ ] 前后端项目初始化
- [ ] 数据库设计与建表
- [ ] 用户注册/登录功能
- [ ] Token认证机制

#### 阶段2：核心模块开发（第3-5周）
- [ ] "我需要"模块（CRUD）
- [ ] "我服务"模块（CRUD）
- [ ] 文件上传功能
- [ ] 分页功能

#### 阶段3：高级功能（第6-7周）
- [ ] 统计分析模块
- [ ] 数据可视化
- [ ] 响应接受/拒绝逻辑

#### 阶段4：测试与优化（第8周）
- [ ] 功能测试
- [ ] Bug修复
- [ ] 文档编写

### 7.2 三人小组分工建议

#### 方案A：前后端分工

**成员1（后端主力）35%**
- Django项目搭建
- 用户认证模块（后端）
- "我需要"模块（后端API）
- 数据库设计与测试数据

**成员2（前端主力）35%**
- Next.js项目搭建
- 所有前端页面开发
- UI组件开发
- 前后端联调

**成员3（全栈）30%**
- "我服务"模块（前后端）
- 统计分析模块（前后端）
- 文件上传功能
- 文档编写

#### 方案B：模块化分工

**成员1（用户+需求）35%**
- 用户模块（前后端）
- "我需要"模块（前后端）

**成员2（响应）35%**
- "我服务"模块（前后端）
- 响应管理功能

**成员3（统计+文档）30%**
- 统计分析模块（前后端）
- 文件上传
- 文档与测试

---

## 八、部署与测试

### 8.1 本地运行

**后端**：
```bash
cd backend
python manage.py makemigrations
python manage.py migrate
python manage.py createsuperuser
python manage.py runserver
```

访问：http://localhost:8000/api/

**前端**：
```bash
cd frontend
npm install
npm run dev
```

访问：http://localhost:3000

### 8.2 测试检查清单

#### 功能测试
- [ ] 用户注册（密码验证）
- [ ] 用户登录
- [ ] 用户信息修改
- [ ] 发布需求（含文件上传）
- [ ] 查询需求（分页、筛选）
- [ ] 修改/删除需求（业务规则）
- [ ] 提交响应
- [ ] 接受/拒绝响应
- [ ] 统计分析（图表展示）

#### 技术验证
- [ ] Django + DRF + ORM（满足3种框架要求）
- [ ] SQLite数据库
- [ ] RESTful API
- [ ] Token认证
- [ ] 分页功能
- [ ] 文件上传
- [ ] CUD确认提示

### 8.3 提交材料

#### 1. 工程源代码
```
姓名1_姓名2_姓名3.rar
├── backend/
├── frontend/
└── README.md
```

#### 2. sql.txt
```sql
-- 建表语句
CREATE TABLE users (...);
...

-- 测试数据
INSERT INTO users VALUES (...);
...
```

#### 3. 设计实现报告
- 运行环境配置
- 已实现功能列表
- 未实现功能说明
- 额外功能
- 关键界面截图
- 类交互设计说明

#### 4. 小组分工说明
```
成员1（张三）：35%
- 负责后端用户模块和需求模块
- 数据库设计
- ...

成员2（李四）：35%
- 负责前端所有页面开发
- UI组件设计
- ...

成员3（王五）：30%
- 负责统计模块
- 文档编写
- ...
```

---

## 附录

### A. 服务类型编码表

| 编码 | 名称 |
|------|------|
| PIPE_REPAIR | 管道维修 |
| ELDERLY_CARE | 助老服务 |
| CLEANING | 保洁服务 |
| MEDICAL_ASSIST | 就诊服务 |
| MEAL_SERVICE | 营养餐服务 |
| TRANSPORT | 定期接送服务 |
| OTHER | 其他 |

### B. 状态码说明

**需求状态**：
- 0：已发布
- -1：已取消

**响应状态**：
- 0：待接受
- 1：已同意
- 2：已拒绝
- 3：已取消

### C. 常见问题

**Q1：SQLite支持JSON字段吗？**
A：Django ORM会自动处理，将JSON转换为TEXT存储。

**Q2：如何实现文件上传？**
A：后端使用Django的FileField或直接处理multipart/form-data，前端使用FormData。

**Q3：密码如何加密存储？**
A：Django自动使用PBKDF2算法加密，使用`user.set_password()`方法。

**Q4：如何实现分页？**
A：后端使用DRF的PageNumberPagination，前端传递page参数。

---

**文档结束**

**版本**：v1.0
**日期**：2024-11-24
**作者**：课程设计小组
